<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuizMaster - Code Source Complet</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: #1a1a2e; 
            color: #eee; 
            line-height: 1.6;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        /* Header */
        header { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            padding: 40px 20px; 
            text-align: center; 
            margin-bottom: 30px;
        }
        header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        header p { font-size: 1.2rem; opacity: 0.9; }
        
        /* Navigation */
        .nav { 
            background: #16213e; 
            padding: 15px; 
            border-radius: 10px; 
            margin-bottom: 30px;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .nav h3 { margin-bottom: 15px; color: #667eea; }
        .nav ul { list-style: none; display: flex; flex-wrap: wrap; gap: 10px; }
        .nav a { 
            color: #eee; 
            text-decoration: none; 
            padding: 8px 15px; 
            background: #0f3460; 
            border-radius: 5px;
            transition: all 0.3s;
        }
        .nav a:hover { background: #667eea; }
        
        /* Sections */
        .section { 
            background: #16213e; 
            border-radius: 10px; 
            padding: 25px; 
            margin-bottom: 30px;
            border-left: 4px solid #667eea;
        }
        .section h2 { 
            color: #667eea; 
            margin-bottom: 15px; 
            padding-bottom: 10px;
            border-bottom: 1px solid #0f3460;
        }
        .section h3 { color: #a855f7; margin: 20px 0 10px; }
        
        /* Code blocks */
        pre { 
            background: #0d1117 !important; 
            border-radius: 8px; 
            padding: 20px !important;
            overflow-x: auto;
            margin: 15px 0;
        }
        code { font-family: 'Fira Code', 'Consolas', monospace; font-size: 14px; }
        
        /* File header */
        .file-header { 
            background: #0f3460; 
            padding: 10px 15px; 
            border-radius: 8px 8px 0 0;
            margin-bottom: -8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .file-header span { color: #667eea; font-weight: bold; }
        .file-icon { color: #f59e0b; }
        
        /* Structure */
        .structure { 
            background: #0d1117; 
            padding: 20px; 
            border-radius: 8px; 
            font-family: monospace;
            white-space: pre;
            overflow-x: auto;
        }
        .structure .folder { color: #f59e0b; }
        .structure .file { color: #22d3ee; }
        
        /* Info box */
        .info { 
            background: #1e3a5f; 
            padding: 15px; 
            border-radius: 8px; 
            margin: 15px 0;
            border-left: 4px solid #22d3ee;
        }
        .info strong { color: #22d3ee; }
        
        /* Table */
        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #0f3460; }
        th { background: #0f3460; color: #667eea; }
        tr:hover { background: #0f3460; }
        
        @media (max-width: 768px) {
            .nav ul { flex-direction: column; }
            header h1 { font-size: 1.8rem; }
        }
    </style>
</head>
<body>

<header>
    <h1>ğŸ“ QuizMaster - Code Source</h1>
    <p>Documentation complÃ¨te du projet PHP OOP pour dÃ©butants</p>
</header>

<div class="container">

<!-- Navigation -->
<nav class="nav">
    <h3>ğŸ“š Table des MatiÃ¨res</h3>
    <ul>
        <li><a href="#structure">ğŸ“ Structure</a></li>
        <li><a href="#sql">ğŸ—„ï¸ Base de donnÃ©es</a></li>
        <li><a href="#config">âš™ï¸ Configuration</a></li>
        <li><a href="#database">Database.php</a></li>
        <li><a href="#security">Security.php</a></li>
        <li><a href="#user">User.php</a></li>
        <li><a href="#category">Category.php</a></li>
        <li><a href="#quiz">Quiz.php</a></li>
        <li><a href="#question">Question.php</a></li>
        <li><a href="#result">Result.php</a></li>
    </ul>
</nav>

<!-- Structure du Projet -->
<section id="structure" class="section">
    <h2>ğŸ“ Structure du Projet</h2>
    <div class="structure">
<span class="folder">qodex_debrefing-v1/</span>
â”œâ”€â”€ <span class="folder">actions/</span>                 <span style="color:#888"># Traitement des formulaires</span>
â”‚   â”œâ”€â”€ <span class="file">category_create.php</span>
â”‚   â”œâ”€â”€ <span class="file">category_update.php</span>
â”‚   â”œâ”€â”€ <span class="file">category_delete.php</span>
â”‚   â”œâ”€â”€ <span class="file">login_action.php</span>
â”‚   â”œâ”€â”€ <span class="file">register_action.php</span>
â”‚   â”œâ”€â”€ <span class="file">quiz_create.php</span>
â”‚   â”œâ”€â”€ <span class="file">quiz_update.php</span>
â”‚   â”œâ”€â”€ <span class="file">quiz_delete.php</span>
â”‚   â”œâ”€â”€ <span class="file">quiz_toggle.php</span>
â”‚   â”œâ”€â”€ <span class="file">question_create.php</span>
â”‚   â”œâ”€â”€ <span class="file">question_update.php</span>
â”‚   â””â”€â”€ <span class="file">question_delete.php</span>
â”‚
â”œâ”€â”€ <span class="folder">classes/</span>                  <span style="color:#888"># Classes OOP</span>
â”‚   â”œâ”€â”€ <span class="file">Database.php</span>           <span style="color:#888"># Singleton - Connexion BDD</span>
â”‚   â”œâ”€â”€ <span class="file">Security.php</span>           <span style="color:#888"># SÃ©curitÃ© (CSRF, XSS)</span>
â”‚   â”œâ”€â”€ <span class="file">User.php</span>               <span style="color:#888"># Avec Getters/Setters</span>
â”‚   â”œâ”€â”€ <span class="file">Category.php</span>           <span style="color:#888"># CRUD CatÃ©gories</span>
â”‚   â”œâ”€â”€ <span class="file">Quiz.php</span>               <span style="color:#888"># CRUD Quiz</span>
â”‚   â”œâ”€â”€ <span class="file">Question.php</span>           <span style="color:#888"># CRUD Questions</span>
â”‚   â””â”€â”€ <span class="file">Result.php</span>             <span style="color:#888"># CRUD RÃ©sultats</span>
â”‚
â”œâ”€â”€ <span class="folder">config/</span>
â”‚   â””â”€â”€ <span class="file">database.php</span>           <span style="color:#888"># Configuration BDD</span>
â”‚
â”œâ”€â”€ <span class="folder">pages/</span>
â”‚   â”œâ”€â”€ <span class="folder">auth/</span>                  <span style="color:#888"># Authentification</span>
â”‚   â”‚   â”œâ”€â”€ <span class="file">login.php</span>
â”‚   â”‚   â”œâ”€â”€ <span class="file">register.php</span>
â”‚   â”‚   â””â”€â”€ <span class="file">logout.php</span>
â”‚   â”‚
â”‚   â”œâ”€â”€ <span class="folder">teacher/</span>               <span style="color:#888"># Espace Enseignant</span>
â”‚   â”‚   â”œâ”€â”€ <span class="file">dashboard.php</span>
â”‚   â”‚   â”œâ”€â”€ <span class="file">categories.php</span>
â”‚   â”‚   â”œâ”€â”€ <span class="file">category_edit.php</span>
â”‚   â”‚   â”œâ”€â”€ <span class="file">quiz.php</span>
â”‚   â”‚   â”œâ”€â”€ <span class="file">quiz_create.php</span>
â”‚   â”‚   â”œâ”€â”€ <span class="file">quiz_edit.php</span>
â”‚   â”‚   â””â”€â”€ <span class="file">mes_resultats.php</span>
â”‚   â”‚
â”‚   â””â”€â”€ <span class="folder">partials/</span>              <span style="color:#888"># Composants rÃ©utilisables</span>
â”‚       â”œâ”€â”€ <span class="file">header.php</span>
â”‚       â”œâ”€â”€ <span class="file">footer.php</span>
â”‚       â”œâ”€â”€ <span class="file">nav_teacher.php</span>
â”‚       â””â”€â”€ <span class="file">alerts.php</span>
â”‚
â”œâ”€â”€ <span class="file">database.sql</span>              <span style="color:#888"># Script SQL</span>
â””â”€â”€ <span class="file">index.php</span>                 <span style="color:#888"># Point d'entrÃ©e</span>
    </div>
</section>

<!-- Base de donnÃ©es SQL -->
<section id="sql" class="section">
    <h2>ğŸ—„ï¸ Base de DonnÃ©es (database.sql)</h2>
    
    <div class="info">
        <strong>ğŸ“Œ Instructions:</strong> Importez ce fichier dans phpMyAdmin pour crÃ©er la base de donnÃ©es.
    </div>
    
    <div class="file-header">
        <span class="file-icon">ğŸ“„</span>
        <span>database.sql</span>
    </div>
    <pre><code class="language-sql">-- =====================================================
-- Base de donnÃ©es QuizMaster
-- Script SQL simple pour les dÃ©butants
-- =====================================================

-- CrÃ©er la base de donnÃ©es
CREATE DATABASE IF NOT EXISTS quiz_platform CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE quiz_platform;

-- =====================================================
-- Table: users (Utilisateurs)
-- =====================================================
CREATE TABLE IF NOT EXISTS users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nom VARCHAR(100) NOT NULL,
    email VARCHAR(255) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    role ENUM('enseignant', 'etudiant') DEFAULT 'enseignant',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL
);

-- =====================================================
-- Table: categories (CatÃ©gories de quiz)
-- =====================================================
CREATE TABLE IF NOT EXISTS categories (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nom VARCHAR(100) NOT NULL,
    description TEXT,
    created_by INT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE CASCADE
);

-- =====================================================
-- Table: quiz (Les quiz)
-- =====================================================
CREATE TABLE IF NOT EXISTS quiz (
    id INT AUTO_INCREMENT PRIMARY KEY,
    titre VARCHAR(255) NOT NULL,
    description TEXT,
    categorie_id INT NOT NULL,
    enseignant_id INT NOT NULL,
    is_active TINYINT(1) DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (categorie_id) REFERENCES categories(id) ON DELETE CASCADE,
    FOREIGN KEY (enseignant_id) REFERENCES users(id) ON DELETE CASCADE
);

-- =====================================================
-- Table: questions (Les questions des quiz)
-- =====================================================
CREATE TABLE IF NOT EXISTS questions (
    id INT AUTO_INCREMENT PRIMARY KEY,
    quiz_id INT NOT NULL,
    question TEXT NOT NULL,
    option1 VARCHAR(255) NOT NULL,
    option2 VARCHAR(255) NOT NULL,
    option3 VARCHAR(255) NOT NULL,
    option4 VARCHAR(255) NOT NULL,
    correct_option TINYINT NOT NULL CHECK (correct_option BETWEEN 1 AND 4),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (quiz_id) REFERENCES quiz(id) ON DELETE CASCADE
);

-- =====================================================
-- Table: results (RÃ©sultats des quiz - US7)
-- =====================================================
CREATE TABLE IF NOT EXISTS results (
    id INT AUTO_INCREMENT PRIMARY KEY,
    quiz_id INT NOT NULL,
    etudiant_id INT NOT NULL,
    score INT NOT NULL DEFAULT 0,
    total_questions INT NOT NULL DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (quiz_id) REFERENCES quiz(id) ON DELETE CASCADE,
    FOREIGN KEY (etudiant_id) REFERENCES users(id) ON DELETE CASCADE
);

-- Index pour les performances
CREATE INDEX idx_results_etudiant ON results(etudiant_id);
CREATE INDEX idx_results_quiz ON results(quiz_id);
CREATE INDEX idx_quiz_active ON quiz(is_active);

-- =====================================================
-- DonnÃ©es de test
-- Mot de passe: password123
-- =====================================================
INSERT INTO users (nom, email, password_hash, role) VALUES 
('Prof Demo', 'prof@demo.com', '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'enseignant'),
('Etudiant Test', 'etudiant@demo.com', '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'etudiant');</code></pre>
</section>

<!-- Configuration -->
<section id="config" class="section">
    <h2>âš™ï¸ Configuration (config/database.php)</h2>
    
    <div class="file-header">
        <span class="file-icon">ğŸ“„</span>
        <span>config/database.php</span>
    </div>
    <pre><code class="language-php">&lt;?php
/**
 * Configuration de la base de donnÃ©es
 */

define('DB_HOST', 'localhost');
define('DB_NAME', 'quiz_platform');
define('DB_USER', 'root');
define('DB_PASS', '');
define('DB_CHARSET', 'utf8mb4');

// Configuration des sessions sÃ©curisÃ©es
ini_set('session.cookie_httponly', 1);
ini_set('session.use_only_cookies', 1);
ini_set('session.cookie_secure', 0); // Mettre Ã  1 si HTTPS
ini_set('session.cookie_samesite', 'Strict');

// DurÃ©e de vie de la session (30 minutes)
ini_set('session.gc_maxlifetime', 1800);
session_set_cookie_params(1800);

// DÃ©marrage de la session
if (session_status() === PHP_SESSION_NONE) {
    session_start();
}

// RÃ©gÃ©nÃ©ration de l'ID de session
if (!isset($_SESSION['initiated'])) {
    session_regenerate_id(true);
    $_SESSION['initiated'] = true;
}</code></pre>
</section>

<!-- Database.php -->
<section id="database" class="section">
    <h2>ğŸ”Œ Classe Database (Pattern Singleton)</h2>
    
    <div class="info">
        <strong>ğŸ“Œ Concept:</strong> Le pattern Singleton garantit qu'une seule instance de la connexion existe.
    </div>
    
    <div class="file-header">
        <span class="file-icon">ğŸ“„</span>
        <span>classes/Database.php</span>
    </div>
    <pre><code class="language-php">&lt;?php
/**
 * Classe Database - Pattern Singleton
 * GÃ¨re la connexion Ã  la base de donnÃ©es
 */

class Database {
    private static $instance = null;  // Instance unique
    private $connection;              // Connexion PDO
    
    /**
     * Constructeur privÃ© (empÃªche new Database())
     */
    private function __construct() {
        try {
            $dsn = "mysql:host=" . DB_HOST . ";dbname=" . DB_NAME . ";charset=" . DB_CHARSET;
            $options = [
                PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
                PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
                PDO::ATTR_EMULATE_PREPARES => false,
            ];
            
            $this->connection = new PDO($dsn, DB_USER, DB_PASS, $options);
        } catch (PDOException $e) {
            die("Erreur de connexion : " . $e->getMessage());
        }
    }
    
    /**
     * EmpÃªche le clonage
     */
    private function __clone() {}
    
    /**
     * RÃ©cupÃ¨re l'instance unique
     */
    public static function getInstance() {
        if (self::$instance === null) {
            self::$instance = new self();
        }
        return self::$instance;
    }
    
    /**
     * RÃ©cupÃ¨re la connexion PDO
     */
    public function getConnection() {
        return $this->connection;
    }
    
    /**
     * ExÃ©cute une requÃªte prÃ©parÃ©e
     */
    public function query($sql, $params = []) {
        $stmt = $this->connection->prepare($sql);
        $stmt->execute($params);
        return $stmt;
    }
}</code></pre>
</section>

<!-- Security.php -->
<section id="security" class="section">
    <h2>ğŸ”’ Classe Security</h2>
    
    <div class="info">
        <strong>ğŸ“Œ Concept:</strong> MÃ©thodes statiques pour la sÃ©curitÃ© (CSRF, XSS, validation).
    </div>
    
    <div class="file-header">
        <span class="file-icon">ğŸ“„</span>
        <span>classes/Security.php</span>
    </div>
    <pre><code class="language-php">&lt;?php
/**
 * Classe Security
 * GÃ¨re la sÃ©curitÃ© : CSRF, XSS, validation
 */

class Security {
    
    /**
     * GÃ©nÃ¨re un token CSRF
     */
    public static function generateCSRFToken() {
        if (!isset($_SESSION['csrf_token'])) {
            $_SESSION['csrf_token'] = bin2hex(random_bytes(32));
        }
        return $_SESSION['csrf_token'];
    }
    
    /**
     * VÃ©rifie le token CSRF
     */
    public static function verifyCSRFToken($token) {
        if (!isset($_SESSION['csrf_token'])) {
            return false;
        }
        return hash_equals($_SESSION['csrf_token'], $token);
    }
    
    /**
     * Nettoie une chaÃ®ne (anti-XSS)
     */
    public static function clean($data) {
        $data = trim($data);
        $data = stripslashes($data);
        $data = htmlspecialchars($data, ENT_QUOTES, 'UTF-8');
        return $data;
    }
    
    /**
     * Valide un email
     */
    public static function validateEmail($email) {
        return filter_var($email, FILTER_VALIDATE_EMAIL) !== false;
    }
    
    /**
     * Valide un mot de passe (min 8 caractÃ¨res)
     */
    public static function validatePassword($password) {
        return strlen($password) >= 8;
    }
    
    /**
     * Hash un mot de passe
     */
    public static function hashPassword($password) {
        return password_hash($password, PASSWORD_BCRYPT);
    }
    
    /**
     * VÃ©rifie un mot de passe
     */
    public static function verifyPassword($password, $hash) {
        return password_verify($password, $hash);
    }
    
    /**
     * VÃ©rifie si connectÃ©
     */
    public static function isLoggedIn() {
        return isset($_SESSION['user_id']) && isset($_SESSION['user_role']);
    }
    
    /**
     * VÃ©rifie si enseignant
     */
    public static function isTeacher() {
        return self::isLoggedIn() && $_SESSION['user_role'] === 'enseignant';
    }
    
    /**
     * Redirige si non connectÃ©
     */
    public static function requireLogin() {
        if (!self::isLoggedIn()) {
            header('Location: ../auth/login.php');
            exit();
        }
    }
    
    /**
     * Redirige si non enseignant
     */
    public static function requireTeacher() {
        self::requireLogin();
        if (!self::isTeacher()) {
            header('Location: ../teacher/dashboard.php');
            exit();
        }
    }
}</code></pre>
</section>

<!-- User.php -->
<section id="user" class="section">
    <h2>ğŸ‘¤ Classe User (avec Getters/Setters)</h2>
    
    <div class="info">
        <strong>ğŸ“Œ Concepts OOP:</strong> Encapsulation, Getters/Setters, VisibilitÃ© (private/public)
    </div>
    
    <h3>Structure de la classe</h3>
    <table>
        <tr><th>PropriÃ©tÃ©</th><th>Type</th><th>VisibilitÃ©</th><th>Description</th></tr>
        <tr><td>$db</td><td>Database</td><td>private</td><td>Instance BDD</td></tr>
        <tr><td>$id</td><td>int</td><td>private</td><td>ID utilisateur</td></tr>
        <tr><td>$nom</td><td>string</td><td>private</td><td>Nom</td></tr>
        <tr><td>$email</td><td>string</td><td>private</td><td>Email</td></tr>
        <tr><td>$role</td><td>string</td><td>private</td><td>RÃ´le</td></tr>
    </table>
    
    <div class="file-header">
        <span class="file-icon">ğŸ“„</span>
        <span>classes/User.php</span>
    </div>
    <pre><code class="language-php">&lt;?php
/**
 * Classe User - Avec Getters/Setters
 */

class User {
    // ============================================
    // PROPRIÃ‰TÃ‰S PRIVÃ‰ES (Encapsulation)
    // ============================================
    private $db;
    private $id;
    private $nom;
    private $email;
    private $role;
    private $createdAt;
    
    // ============================================
    // CONSTRUCTEUR
    // ============================================
    public function __construct() {
        $this->db = Database::getInstance();
    }
    
    // ============================================
    // GETTERS (Accesseurs en lecture)
    // ============================================
    public function getId() {
        return $this->id;
    }
    
    public function getNom() {
        return $this->nom;
    }
    
    public function getEmail() {
        return $this->email;
    }
    
    public function getRole() {
        return $this->role;
    }
    
    // ============================================
    // SETTERS (Accesseurs en Ã©criture)
    // ============================================
    public function setNom($nom) {
        if (!empty($nom)) {
            $this->nom = $nom;
        }
    }
    
    public function setEmail($email) {
        if (Security::validateEmail($email)) {
            $this->email = $email;
            return true;
        }
        return false;
    }
    
    public function setRole($role) {
        if (in_array($role, ['enseignant', 'etudiant'])) {
            $this->role = $role;
            return true;
        }
        return false;
    }
    
    // ============================================
    // MÃ‰THODE PRIVÃ‰E: Hydratation
    // ============================================
    private function hydrate($data) {
        $this->id = $data['id'] ?? null;
        $this->nom = $data['nom'] ?? '';
        $this->email = $data['email'] ?? '';
        $this->role = $data['role'] ?? '';
        $this->createdAt = $data['created_at'] ?? '';
    }
    
    // ============================================
    // MÃ‰THODES CRUD
    // ============================================
    
    /**
     * CrÃ©e un utilisateur
     */
    public function create($nom, $email, $password, $role = 'enseignant') {
        if (empty($nom) || empty($email) || empty($password)) {
            return false;
        }
        
        if (!Security::validateEmail($email) || !Security::validatePassword($password)) {
            return false;
        }
        
        if ($this->emailExists($email)) {
            return false;
        }
        
        $passwordHash = Security::hashPassword($password);
        
        $sql = "INSERT INTO users (nom, email, password_hash, role) VALUES (?, ?, ?, ?)";
        try {
            $this->db->query($sql, [$nom, $email, $passwordHash, $role]);
            return true;
        } catch (Exception $e) {
            return false;
        }
    }
    
    /**
     * VÃ©rifie si un email existe
     */
    public function emailExists($email) {
        $sql = "SELECT id FROM users WHERE email = ? AND deleted_at IS NULL";
        $result = $this->db->query($sql, [$email]);
        return $result->rowCount() > 0;
    }
    
    /**
     * Connexion
     */
    public function login($email, $password) {
        $sql = "SELECT * FROM users WHERE email = ? AND deleted_at IS NULL";
        $result = $this->db->query($sql, [$email]);
        $user = $result->fetch();
        
        if ($user && Security::verifyPassword($password, $user['password_hash'])) {
            $this->hydrate($user);
            
            $_SESSION['user_id'] = $user['id'];
            $_SESSION['user_nom'] = $user['nom'];
            $_SESSION['user_email'] = $user['email'];
            $_SESSION['user_role'] = $user['role'];
            
            session_regenerate_id(true);
            return $user;
        }
        
        return false;
    }
    
    /**
     * DÃ©connexion
     */
    public function logout() {
        session_unset();
        session_destroy();
        session_start();
        session_regenerate_id(true);
    }
    
    /**
     * RÃ©cupÃ¨re par ID
     */
    public function getById($id) {
        $sql = "SELECT id, nom, email, role, created_at FROM users WHERE id = ? AND deleted_at IS NULL";
        $result = $this->db->query($sql, [$id]);
        $data = $result->fetch();
        
        if ($data) {
            $this->hydrate($data);
        }
        
        return $data;
    }
}</code></pre>
</section>

<!-- Category.php -->
<section id="category" class="section">
    <h2>ğŸ“ Classe Category</h2>
    
    <div class="file-header">
        <span class="file-icon">ğŸ“„</span>
        <span>classes/Category.php</span>
    </div>
    <pre><code class="language-php">&lt;?php
/**
 * Classe Category - CRUD CatÃ©gories
 */

class Category {
    private $db;
    
    public function __construct() {
        $this->db = Database::getInstance();
    }
    
    /**
     * CrÃ©e une catÃ©gorie
     */
    public function create($nom, $description, $createdBy) {
        if (empty($nom) || empty($createdBy)) {
            return false;
        }
        
        $sql = "INSERT INTO categories (nom, description, created_by) VALUES (?, ?, ?)";
        try {
            $this->db->query($sql, [$nom, $description, $createdBy]);
            return $this->db->getConnection()->lastInsertId();
        } catch (Exception $e) {
            return false;
        }
    }
    
    /**
     * RÃ©cupÃ¨re les catÃ©gories d'un enseignant
     */
    public function getAllByTeacher($teacherId) {
        $sql = "SELECT c.*, COUNT(DISTINCT q.id) as quiz_count
                FROM categories c
                LEFT JOIN quiz q ON c.id = q.categorie_id
                WHERE c.created_by = ?
                GROUP BY c.id
                ORDER BY c.created_at DESC";
        
        $result = $this->db->query($sql, [$teacherId]);
        return $result->fetchAll();
    }
    
    /**
     * RÃ©cupÃ¨re par ID
     */
    public function getById($id) {
        $sql = "SELECT * FROM categories WHERE id = ?";
        $result = $this->db->query($sql, [$id]);
        return $result->fetch();
    }
    
    /**
     * VÃ©rifie la propriÃ©tÃ©
     */
    public function isOwner($categoryId, $teacherId) {
        $sql = "SELECT id FROM categories WHERE id = ? AND created_by = ?";
        $result = $this->db->query($sql, [$categoryId, $teacherId]);
        return $result->rowCount() > 0;
    }
    
    /**
     * Met Ã  jour
     */
    public function update($id, $nom, $description, $teacherId) {
        if (!$this->isOwner($id, $teacherId)) {
            return false;
        }
        
        $sql = "UPDATE categories SET nom = ?, description = ? WHERE id = ?";
        try {
            $this->db->query($sql, [$nom, $description, $id]);
            return true;
        } catch (Exception $e) {
            return false;
        }
    }
    
    /**
     * Supprime
     */
    public function delete($id, $teacherId) {
        if (!$this->isOwner($id, $teacherId)) {
            return false;
        }
        
        if ($this->hasQuizzes($id)) {
            return false;
        }
        
        $sql = "DELETE FROM categories WHERE id = ?";
        try {
            $this->db->query($sql, [$id]);
            return true;
        } catch (Exception $e) {
            return false;
        }
    }
    
    /**
     * VÃ©rifie si a des quiz
     */
    public function hasQuizzes($categoryId) {
        $sql = "SELECT COUNT(*) as count FROM quiz WHERE categorie_id = ?";
        $result = $this->db->query($sql, [$categoryId]);
        $data = $result->fetch();
        return $data['count'] > 0;
    }
}</code></pre>
</section>

<!-- Quiz.php -->
<section id="quiz" class="section">
    <h2>ğŸ“ Classe Quiz</h2>
    
    <div class="file-header">
        <span class="file-icon">ğŸ“„</span>
        <span>classes/Quiz.php</span>
    </div>
    <pre><code class="language-php">&lt;?php
/**
 * Classe Quiz - CRUD Quiz
 */

class Quiz {
    private $db;
    
    public function __construct() {
        $this->db = Database::getInstance();
    }
    
    /**
     * CrÃ©e un quiz
     */
    public function create($titre, $description, $categorieId, $enseignantId) {
        if (empty($titre) || empty($categorieId) || empty($enseignantId)) {
            return false;
        }
        
        $sql = "INSERT INTO quiz (titre, description, categorie_id, enseignant_id) 
                VALUES (?, ?, ?, ?)";
        try {
            $this->db->query($sql, [$titre, $description, $categorieId, $enseignantId]);
            return $this->db->getConnection()->lastInsertId();
        } catch (Exception $e) {
            return false;
        }
    }
    
    /**
     * RÃ©cupÃ¨re les quiz d'un enseignant
     */
    public function getAllByTeacher($teacherId) {
        $sql = "SELECT q.*, c.nom as categorie_nom,
                       COUNT(DISTINCT qu.id) as questions_count,
                       COUNT(DISTINCT r.id) as participants_count
                FROM quiz q
                LEFT JOIN categories c ON q.categorie_id = c.id
                LEFT JOIN questions qu ON q.id = qu.quiz_id
                LEFT JOIN results r ON q.id = r.quiz_id
                WHERE q.enseignant_id = ?
                GROUP BY q.id
                ORDER BY q.created_at DESC";
        
        $result = $this->db->query($sql, [$teacherId]);
        return $result->fetchAll();
    }
    
    /**
     * RÃ©cupÃ¨re par ID
     */
    public function getById($id) {
        $sql = "SELECT q.*, c.nom as categorie_nom
                FROM quiz q
                LEFT JOIN categories c ON q.categorie_id = c.id
                WHERE q.id = ?";
        $result = $this->db->query($sql, [$id]);
        return $result->fetch();
    }
    
    /**
     * VÃ©rifie la propriÃ©tÃ©
     */
    public function isOwner($quizId, $teacherId) {
        $sql = "SELECT id FROM quiz WHERE id = ? AND enseignant_id = ?";
        $result = $this->db->query($sql, [$quizId, $teacherId]);
        return $result->rowCount() > 0;
    }
    
    /**
     * Met Ã  jour
     */
    public function update($id, $titre, $description, $categorieId, $teacherId) {
        if (!$this->isOwner($id, $teacherId)) {
            return false;
        }
        
        $sql = "UPDATE quiz SET titre = ?, description = ?, categorie_id = ? WHERE id = ?";
        try {
            $this->db->query($sql, [$titre, $description, $categorieId, $id]);
            return true;
        } catch (Exception $e) {
            return false;
        }
    }
    
    /**
     * Active/DÃ©sactive
     */
    public function toggleActive($id, $isActive, $teacherId) {
        if (!$this->isOwner($id, $teacherId)) {
            return false;
        }
        
        $sql = "UPDATE quiz SET is_active = ? WHERE id = ?";
        try {
            $this->db->query($sql, [$isActive, $id]);
            return true;
        } catch (Exception $e) {
            return false;
        }
    }
    
    /**
     * Supprime
     */
    public function delete($id, $teacherId) {
        if (!$this->isOwner($id, $teacherId)) {
            return false;
        }
        
        $sql = "DELETE FROM quiz WHERE id = ?";
        try {
            $this->db->query($sql, [$id]);
            return true;
        } catch (Exception $e) {
            return false;
        }
    }
}</code></pre>
</section>

<!-- Question.php -->
<section id="question" class="section">
    <h2>â“ Classe Question</h2>
    
    <div class="file-header">
        <span class="file-icon">ğŸ“„</span>
        <span>classes/Question.php</span>
    </div>
    <pre><code class="language-php">&lt;?php
/**
 * Classe Question - CRUD Questions
 */

class Question {
    private $db;
    
    public function __construct() {
        $this->db = Database::getInstance();
    }
    
    /**
     * CrÃ©e une question
     */
    public function create($quizId, $question, $option1, $option2, $option3, $option4, $correctOption) {
        if (empty($quizId) || empty($question) || $correctOption < 1 || $correctOption > 4) {
            return false;
        }
        
        $sql = "INSERT INTO questions (quiz_id, question, option1, option2, option3, option4, correct_option) 
                VALUES (?, ?, ?, ?, ?, ?, ?)";
        try {
            $this->db->query($sql, [$quizId, $question, $option1, $option2, $option3, $option4, $correctOption]);
            return $this->db->getConnection()->lastInsertId();
        } catch (Exception $e) {
            return false;
        }
    }
    
    /**
     * RÃ©cupÃ¨re les questions d'un quiz
     */
    public function getAllByQuiz($quizId) {
        $sql = "SELECT * FROM questions WHERE quiz_id = ? ORDER BY id ASC";
        $result = $this->db->query($sql, [$quizId]);
        return $result->fetchAll();
    }
    
    /**
     * RÃ©cupÃ¨re par ID
     */
    public function getById($id) {
        $sql = "SELECT * FROM questions WHERE id = ?";
        $result = $this->db->query($sql, [$id]);
        return $result->fetch();
    }
    
    /**
     * Met Ã  jour
     */
    public function update($id, $question, $option1, $option2, $option3, $option4, $correctOption) {
        if ($correctOption < 1 || $correctOption > 4) {
            return false;
        }
        
        $sql = "UPDATE questions 
                SET question = ?, option1 = ?, option2 = ?, option3 = ?, option4 = ?, correct_option = ? 
                WHERE id = ?";
        try {
            $this->db->query($sql, [$question, $option1, $option2, $option3, $option4, $correctOption, $id]);
            return true;
        } catch (Exception $e) {
            return false;
        }
    }
    
    /**
     * Supprime
     */
    public function delete($id) {
        $sql = "DELETE FROM questions WHERE id = ?";
        try {
            $this->db->query($sql, [$id]);
            return true;
        } catch (Exception $e) {
            return false;
        }
    }
    
    /**
     * Compte les questions d'un quiz
     */
    public function countByQuiz($quizId) {
        $sql = "SELECT COUNT(*) as count FROM questions WHERE quiz_id = ?";
        $result = $this->db->query($sql, [$quizId]);
        $data = $result->fetch();
        return (int)$data['count'];
    }
}</code></pre>
</section>

<!-- Result.php -->
<section id="result" class="section">
    <h2>ğŸ“Š Classe Result (US7 - Voir ses rÃ©sultats)</h2>
    
    <div class="info">
        <strong>ğŸ”’ SÃ©curitÃ©:</strong> L'utilisateur ne peut voir QUE ses propres rÃ©sultats.
    </div>
    
    <div class="file-header">
        <span class="file-icon">ğŸ“„</span>
        <span>classes/Result.php</span>
    </div>
    <pre><code class="language-php">&lt;?php
/**
 * Classe Result - CRUD RÃ©sultats
 * SÃ‰CURITÃ‰: L'utilisateur ne peut voir QUE ses propres rÃ©sultats
 */

class Result {
    private $db;
    
    public function __construct() {
        $this->db = Database::getInstance();
    }
    
    /**
     * RÃ©cupÃ¨re MES rÃ©sultats (sÃ©curisÃ©)
     */
    public function getMyResults($etudiantId) {
        $sql = "SELECT r.*, q.titre as quiz_titre, c.nom as categorie_nom
                FROM results r
                LEFT JOIN quiz q ON r.quiz_id = q.id
                LEFT JOIN categories c ON q.categorie_id = c.id
                WHERE r.etudiant_id = ?
                ORDER BY r.created_at DESC";
        
        $result = $this->db->query($sql, [$etudiantId]);
        return $result->fetchAll();
    }
    
    /**
     * RÃ©cupÃ¨re un rÃ©sultat par ID (vÃ©rifie le propriÃ©taire)
     */
    public function getById($resultId, $etudiantId) {
        $sql = "SELECT r.*, q.titre as quiz_titre
                FROM results r
                LEFT JOIN quiz q ON r.quiz_id = q.id
                WHERE r.id = ? AND r.etudiant_id = ?";
        
        $result = $this->db->query($sql, [$resultId, $etudiantId]);
        return $result->fetch();
    }
    
    /**
     * Enregistre un rÃ©sultat
     */
    public function save($quizId, $etudiantId, $score, $totalQuestions) {
        $sql = "INSERT INTO results (quiz_id, etudiant_id, score, total_questions, created_at) 
                VALUES (?, ?, ?, ?, NOW())";
        
        try {
            $this->db->query($sql, [$quizId, $etudiantId, $score, $totalQuestions]);
            return $this->db->getConnection()->lastInsertId();
        } catch (Exception $e) {
            return false;
        }
    }
    
    /**
     * Calcule mes statistiques
     */
    public function getMyStats($etudiantId) {
        $sql = "SELECT 
                    COUNT(*) as total_quiz,
                    AVG(score / total_questions * 100) as moyenne,
                    MAX(score / total_questions * 100) as meilleur_score
                FROM results
                WHERE etudiant_id = ?";
        
        $result = $this->db->query($sql, [$etudiantId]);
        return $result->fetch();
    }
}</code></pre>
</section>

<!-- Footer -->
<footer style="text-align: center; padding: 30px; color: #888; border-top: 1px solid #0f3460; margin-top: 30px;">
    <p>ğŸ“ QuizMaster - Documentation gÃ©nÃ©rÃ©e pour les apprenants</p>
    <p style="font-size: 0.9rem;">Projet PHP OOP - Pattern MVC SimplifiÃ©</p>
</footer>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-php.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
</body>
</html>

